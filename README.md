# Проектное задание первого спринта

Ваша задача — проанализировать данные по погодным условиям, полученные от API Яндекс Погоды.

## Описание задания

**1. Получите информацию о погодных условиях для указанного списка городов, используя API Яндекс Погоды.**

<details>
<summary> Описание </summary>

Список городов находится в переменной `CITIES` в файле [utils.py](utils.py). Для взаимодействия с API используйте готовый класс `YandexWeatherAPI` в модуле `api_client.py`. Пример работы с классом `YandexWeatherAPI` описан в <a href="#apiusingexample">примере</a>. Пример ответа от API для анализа находится в [файле](examples/response.json).

</details>

**2. Вычислите среднюю температуру и проанализируйте информацию об осадках за указанный период для всех городов.**

<details>
<summary> Описание </summary>

Условия и требования:
- период вычислений в течение дня — с 9 до 19 часов;
- средняя температура рассчитывается за указанный промежуток времени;
- сумма времени (часов), когда погода без осадков (без дождя, снега, града или грозы), рассчитывается за указанный промежуток времени;
- информация о температуре для указанного дня за определённый час находится по следующему пути: `forecasts> [день]> hours> temp`;
- информация об осадках для указанного дня за определённый час находится по следующему пути: `forecasts> [день]> hours> condition`.

[Пример данных](examples/response-day-info.png) с информацией о температуре и осадках за день.

Список вариантов погодных условий находится [в таблице в блоке `condition`](https://yandex.ru/dev/weather/doc/dg/concepts/forecast-test.html#resp-format__forecasts) или в [файле](examples/conditions.txt).

</details>

**3. Объедините полученные данные и сохраните результат в текстовом файле.**

<details>
<summary> Описание </summary>

Формат сохраняемого файла - **json**, **csv** или **xls/xlsx**.

Формат таблицы для сохранения, где рейтинг - позиция города относительно других при анализе "благоприятности поездки" (смотри п4).

| Город/день  |                           | 14-06 | ... | 19-06 | Среднее | Рейтинг |
|-------------|:--------------------------|:-----:|:---:|:-----:|--------:|--------:|
| Москва      | Температура, среднее      |  24   |     |  27   |    25.6 |       8 |
|             | Без осадков, часов        |   8   |     |   4   |       6 |         |
| Абу-Даби    | Температура, среднее      |  34   |     |  37   |    35.5 |       2 |
|             | Без осадков, часов        |   9   |     |  10   |     9.5 |         |
| ...         |                           |       |     |       |         |         |

</details>


**4. Проанализируйте результат и сделайте вывод, какой из городов наиболее благоприятен для поездки.**

<details>
<summary> Описание </summary>

Наиболее благоприятным городом считать тот, в котором средняя температура за всё время была самой высокой, а количество времени без осадков — максимальным.
Если таких городов более одного, то выводить все.

</details>

## Требования к решению

1. Используйте для решения как процессы, так и потоки.
2. Используйте для решения как очередь, так и пул задач.
3. Опишите этапы решения в виде отдельных классов в модуле [tasks.py](tasks.py):
  - `DataFetchingTask` — получение данных через API;
  - `DataCalculationTask` — вычисление погодных параметров;
  - `DataAggregationTask` — объединение вычисленных данных;
  - `DataAnalyzingTask` — финальный анализ и получение результата.
4. Используйте концепции ООП.
5. Предусмотрите обработку исключительных ситуаций.
6. Логируйте результаты действий.
7. Покройте написанный код тестами.
8. Используйте аннотацию типов.
9. Приведите стиль кода в соответствие pep8, flake8, mypy.

---

<a name="apiusingexample"></a>

## Пример использования `YandexWeatherAPI` для работы с API

```python
from api_client import YandexWeatherAPI

city_name = "MOSCOW"
ywAPI = YandexWeatherAPI()
resp = ywAPI.get_forecasting(city_name)
```
### Пояснения к заданию:
```angular2html
Обычно когда сначала собираешь большое количество данных и хочешь их как-то проанализировать, значительно удобнее сохранить их куда-то прежде чем приступать к анализу.

Причин несколько:
1. Получение данных может оборваться на середине и, если куда-то сохранять данные, можно начать не с самого начала, а с того момента как остановился. Когда это часы дёрганья API это значительно)
2. В данных могут быть корнер кейсы, о которых можно забыть когда пишешь логику обработки. Если после долгого получения данных всё упадет из-за какого-то пустого поля или деления на 0, то будет обидно.
3. Иногда можно не до конца представлять как именно выглядят данные и иметь их под рукой во время написания обработки довольно удобно.

Подводя итог, прочитать из файла это быстро и просто, ходить в сеть это долго. Так что я бы сказал правильный вариант решения это получить данные, сохранить их и отдельно анализировать  
Изменять файл точно не стоит, потому что можно повредить данные и, если в вычислении что-то не так, то придется собирать данные
Для конкретного этого задания я бы выводил в консоль потому что там нет большой таблицы и ответ получается достаточно простой
```
```angular2html

Сергей Борисов

Добрый день!
Спринт 1. Проектное задание
Подскажите, где в проектном задании лучше использовать очередь?
По моим рассуждениям, если мы делим задачу на 4 пункта то, что анализ, что скачивание данных логично делать пулом. 
Или же мы выполняем параллельно пункты задания например обрабатывать данные по температуре и погодным условиям и сразу отправлять на просчет рейтинга? Но тогда зачем нам разные классы для этих задач делать?

Анализ это CPU-bound операция, там нужны процессы, скачивание это IO-based операция и там потоки подходят лучше.
По скольку Queue работают с тредами, то ее стоит использовать для скачивания.
Я выше подробно писал (ссылки в пачке не работают) что лучше сохранять куда-то результат полученный скачиванием, так что если сохранить в файл, а потом обрабатывать, то это имеет смысл

Правильно ли я понял:
1. Потоками с помощью очереди скачиваю данные и сохраняю в произвольный файл.
2. Обрабатываю сохраненные данные с помощью пула процессов, получаю параметры температуры и погодных условий.
3. Анализирую данные из пункта 2, получая рейтинг. Делаю вывод в терминале условно топ-3 городов.
4. Сохраняю итоговый файл с информацией по температурам, погодным условиям и рейтингу для каждого города
Такой порядок действий?)

Получается один файл у меня вспомогательный и один итоговый

Мне кажется, что пункты 3 и 4 надо поменять местами. Сначала сохраняешь обработанную информацию в файл (пункт 3 из описания задания), а потом анализируешь его (пункт 4)
```